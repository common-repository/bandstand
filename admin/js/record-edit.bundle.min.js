require=function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){(function(c){"use strict";function d(){if(!(this instanceof d))return new d}function e(a){var b="";return i.each(a,function(a){b+=a.artist.name,i.isUndefined(a.joinphrase)||(b+=a.joinphrase)}),b}function f(a){return{id:a.id,asin:a.asin,artist:e(a["artist-credit"]),externalUrl:"https://musicbrainz.org/release/"+a.id,recordLabel:"label-info"in a?a["label-info"][0].label.name:"",releaseDate:(a.date||"").replace(/-/g,"/"),source:"musicbrainz",title:a.title,trackCount:a["track-count"]}}function g(a){return{musicbrainz_id:a.id,artist:e(a["artist-credit"]),duration:j.util.formatTime(a.length/1e3),source:"musicbrainz",title:a.title,track_number:String(a.number)}}var h="undefined"!=typeof window?window.jQuery:"undefined"!=typeof c?c.jQuery:null,i="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,j=a("bandstand");d.prototype.getTracks=function(a){var b=h.Deferred();return h.ajax({url:"https://musicbrainz.org/ws/2/release/"+a,dataType:"json",data:{inc:"artist-credits recordings",fmt:"json"}}).done(function(a){var c=i.map(a.media[0].tracks,function(a){return g(a)});b.resolve(c)}).fail(function(a){b.reject(a)}),b.promise()},d.prototype.search=function(a){var b=h.Deferred();return h.ajax({url:"https://musicbrainz.org/ws/2/release/",dataType:"json",data:{query:a,fmt:"json"}}).done(function(a){var c=i.map(a.releases,function(a){return f(a)});b.resolve(c)}).fail(function(a){b.reject(a)}),b.promise()},b.exports=new d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{bandstand:"bandstand"}],2:[function(a,b,c){(function(c){"use strict";var d,e="undefined"!=typeof window?window.jQuery:"undefined"!=typeof c?c.jQuery:null,f=("undefined"!=typeof window?window.wp:"undefined"!=typeof c?c.wp:null).api.WPApiBaseCollection,g=a("bandstand").settings(),h=a("models/track");d=f.extend({model:h,url:function(){return g.restUrl+"bandstand/v1/tracks"},initialize:function(a,b){b=b||{},this.recordId=b.recordId||null,f.prototype.initialize.apply(this,arguments)},comparator:function(a){return parseInt(a.get("menu_order"),10)},save:function(){var a=[];return this.each(function(b){a.push(b.save())}),e.when.apply(e,a)}}),b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{bandstand:"bandstand","models/track":27}],3:[function(a,b,c){(function(c){"use strict";var d,e="undefined"!=typeof window?window.Backbone:"undefined"!=typeof c?c.Backbone:null,f=a("../models/search-result");d=e.Collection.extend({model:f}),b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../models/search-result":6}],4:[function(a,b,c){(function(c){"use strict";var d,e="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,f=a("bandstand").l10n,g=localStorage||{},h=a("../collections/search-results"),i="undefined"!=typeof window?window.wp:"undefined"!=typeof c?c.wp:null;d=i.media.controller.State.extend({defaults:{id:"record-finder",title:f.importFromService||"Import from Service",collection:null,content:"record-finder",frame:null,menu:"default",menuItem:{text:f.importFromService||"Import from Service",priority:200},query:"",results:null,selection:null,service:null,services:null,toolbar:"record-finder"},initialize:function(){var a=g.bandstandRecordFinderServiceId,b=this.get("services");this.set("results",new h),this.set("selection",new h),a=a||b.first().get("id"),this.set("service",b.get(a)),this.listenTo(this,"change:service",this.persistService)},importRecord:function(){var a=this.get("frame"),b=this.get("collection"),c=this.get("selection"),d=c.first().get("id"),f=b.first();return 1!==b.length||f.get("id")||f.get("title")||b.remove(f),this.get("service").get("adapter").getTracks(d).done(function(d){e.each(d,function(a){a=e.extend(a,{menu_order:b.length,record_id:b.recordId,status:"publish"}),b.add(a)}),c.reset(),a.setState("tracklist")})},persistService:function(){g.bandstandRecordFinderServiceId=this.get("service").get("id")},search:function(){var a=this.get("results");return this.get("selection").reset(),this.get("service").get("adapter").search(this.get("query")).done(function(b){a.reset(b)})}}),b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../collections/search-results":3,bandstand:"bandstand"}],5:[function(a,b,c){(function(c){"use strict";var d,e="undefined"!=typeof window?window.Backbone:"undefined"!=typeof c?c.Backbone:null,f=a("bandstand").l10n,g=a("../collections/record-tracks"),h=a("bandstand").settings(),i="undefined"!=typeof window?window.wp:"undefined"!=typeof c?c.wp:null;d=i.media.controller.State.extend({defaults:{id:"tracklist",title:f.tracklist||"Tracklist",autoNumber:!1,button:{text:f.addTrack||"Add Track"},collection:null,content:"bandstand-tracklist",deleted:null,isDirty:!1,menu:"default",menuItem:{text:f.manageTracklist||"Manage Tracklist",priority:10},selection:null,toolbar:"tracklist",uploader:!0},initialize:function(a){var b=a.collection||new g,c=a.selection||new e.Collection;this.set("autoNumber",a.autoNumber||!1),this.set("collection",b),this.set("deleted",a.deleted||new e.Collection),this.set("selection",c),this.listenTo(this,"change:autoNumber",this.persistAutoNumber),this.listenTo(this,"change:autoNumber",this.updateTrackNumbers),this.listenTo(this.get("collection"),"add remove reset change:menu_order",this.updateTrackNumbers),this.listenTo(this.get("collection"),"add remove reset change",this.updateDirtyState),this.listenTo(this.get("selection"),"remove",this.updateSelection)},next:function(){var a=this.get("collection"),b=a.indexOf(this.get("selection").at(0));a.length-1!==b&&this.get("selection").reset(a.at(b+1))},previous:function(){var a=this.get("collection"),b=a.indexOf(this.get("selection").at(0));0!==b&&this.get("selection").reset(a.at(b-1))},persistAutoNumber:function(){i.ajax.post("bandstand_ajax_update_tracklist_autonumber",{autonumber:this.get("autoNumber")?1:0,record_id:h.record.id,nonce:h.autoNumberNonce}).done(function(a){})},updateDirtyState:function(){this.set("isDirty",!0)},updateSelection:function(){var a=this.get("collection");a.length&&this.get("selection").reset(a.last())},updateTrackNumbers:function(){this.get("autoNumber")&&this.get("collection").each(function(a,b){a.set("track_number",b+1)})}}),b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../collections/record-tracks":2,bandstand:"bandstand"}],6:[function(a,b,c){(function(a){"use strict";var c,d="undefined"!=typeof window?window.Backbone:"undefined"!=typeof a?a.Backbone:null;c=d.Model.extend({defaults:{id:"",artist:"",title:""}}),b.exports=c}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],7:[function(a,b,c){(function(a){"use strict";var c,d="undefined"!=typeof window?window.wp:"undefined"!=typeof a?a.wp:null;c=d.media.View.extend({className:"bandstand-record-finder-search-group",template:d.template("bandstand-record-finder-search-group"),events:{"click button":"search","keyup input":"updateQuery","keypress input":"search"},initialize:function(a){this.controller=a.controller,this.collection=a.collection,this.selection=a.selection},render:function(){return this.$el.html(this.template()),this.$button=this.$("button"),this.$field=this.$("input").val(this.controller.get("query")),this},search:function(a){var b;"keypress"===a.type&&13!==a.which||(b=this.$button.prop("disabled",!0),this.controller.search().always(function(){b.prop("disabled",!1)}))},updateQuery:function(){this.controller.set("query",this.$field.val())}}),b.exports=c}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],8:[function(a,b,c){(function(a){"use strict";var c,d="undefined"!=typeof window?window.wp:"undefined"!=typeof a?a.wp:null;c=d.Backbone.View.extend({className:"bandstand-record-finder-result",tagName:"li",template:d.template("bandstand-record-finder-result"),events:{click:"setSelection"},initialize:function(a){this.model=a.model,this.selection=a.selection,this.selection.on("reset",this.updateSelected,this)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this},setSelection:function(){this.selection.first()===this.model?this.selection.reset():this.selection.reset(this.model)},updateSelected:function(){this.$el.toggleClass("is-selected",this.selection.first()===this.model)}}),b.exports=c}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],9:[function(a,b,c){(function(c){"use strict";var d,e=a("./search-result"),f="undefined"!=typeof window?window.wp:"undefined"!=typeof c?c.wp:null;d=f.Backbone.View.extend({tagName:"ul",initialize:function(a){this.collection=a.collection,this.selection=a.selection,this.listenTo(this.collection,"reset",this.render),this.listenTo(this.collection,"add",this.addItem)},render:function(){return this.$el.empty(),this.collection.length&&this.collection.each(this.addItem,this),this},addItem:function(a){this.views.add(new e({model:a,selection:this.selection}))}}),b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./search-result":8}],10:[function(a,b,c){(function(a){"use strict";var c,d="undefined"!=typeof window?window.wp:"undefined"!=typeof a?a.wp:null;c=d.media.View.extend({className:"bandstand-record-finder-services-panel",template:d.template("bandstand-record-finder-services-panel"),events:{"change select":"updateService"},initialize:function(a){this.controller=a.controller},render:function(){var a=this.controller.get("services");return this.$el.html(this.template({selected:this.controller.get("service").get("id"),services:a.toJSON()})),this.$dropdown=this.$("select"),this},updateService:function(){var a=this.$dropdown.val(),b=this.controller.get("services");this.controller.set("service",b.get(a))}}),b.exports=c}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],11:[function(a,b,c){(function(c){"use strict";var d,e="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,f=a("bandstand").l10n,g=a("../../controllers/record-finder"),h=a("../record-finder"),i=a("../toolbar/record-finder"),j=a("../../controllers/tracklist"),k=a("../tracklist-manager"),l=a("../toolbar/tracklist"),m="undefined"!=typeof window?window.wp:"undefined"!=typeof c?c.wp:null;d=m.media.view.MediaFrame.Select.extend({className:"media-frame bandstand-tracklist-frame",initialize:function(){e.defaults(this.options,{autoNumberTracklist:!1,collection:null,modal:!0,services:null,state:"tracklist",title:""}),m.media.view.MediaFrame.Select.prototype.initialize.apply(this,arguments)},createStates:function(){this.states.add([new j({autoNumber:this.options.autoNumberTracklist,collection:this.collection}),new m.media.controller.Library({title:f.importFromMediaLibrary||"Import from Media Library",menu:"default",menuItem:{text:f.importFromMedia||"Import from Media",priority:120},toolbar:"media-import",allowLocalEdits:!0,editable:!1,displaySettings:!1,displayUserSettings:!1,filterable:"uploaded",library:m.media.query({type:"audio"}),multiple:"add"}),new g({collection:this.collection,frame:this,query:this.options.record.title,services:this.options.services}),new m.media.controller.Library({id:"select",title:f.selectFile||"Select File",button:{close:!1},library:m.media.query({type:"audio"}),menu:"select",multiple:!1,priority:140,displaySettings:!1,displayUserSettings:!1,filterable:"uploaded"})])},bindHandlers:function(){e.bindAll(this,"addUploadedAttachmentAsTrack"),this.on("menu:create:default",this.createMenu,this),this.on("content:create:bandstand-tracklist",this.createContent,this),this.on("toolbar:create:tracklist",this.createToolbar,this),this.on("toolbar:create:media-import",m.media.view.MediaFrame.Select.prototype.createToolbar,this),this.on("toolbar:render:media-import",this.renderMediaImportToolbar,this),this.on("content:create:record-finder",this.createRecordFinderContent,this),this.on("toolbar:create:record-finder",this.createRecordFinderToolbar,this),this.on("menu:create:select",this.createSelectMenu,this),this.on("toolbar:render:select",this.renderSelectToolbar,this),this.on("uploader:ready",function(){this.uploader.uploader.uploader.bind("FileUploaded",this.addUploadedAttachmentAsTrack)},this),m.media.view.MediaFrame.Select.prototype.bindHandlers.apply(this,arguments)},createContent:function(a){a.view=new k({controller:this,collection:this.state().get("collection"),selection:this.state().get("selection")})},createRecordFinderContent:function(a){a.view=new h({controller:this})},createMenu:function(a){a.view=new m.media.view.Menu({controller:this}),a.view.set({"library-separator":new m.media.View({className:"separator",priority:100})})},createToolbar:function(a){a.view=new l({controller:this})},createRecordFinderToolbar:function(a){a.view=new i({controller:this})},createSelectMenu:function(a){var b=this;a.view=new m.media.view.Menu({controller:this}),a.view.set({cancel:{text:f.cancel||"Cancel",priority:20,click:function(){b.setState("tracklist")}},separateCancel:new m.media.View({className:"separator",priority:40})})},renderMediaImportToolbar:function(a){var b=this;this.selectionStatusToolbar(a),a.set("select",{style:"primary",priority:80,text:f.select||"Select",requires:{selection:!0},click:function(){var a=b.state("tracklist").get("collection"),c=b.state("library").get("selection");c.each(function(b){a.add({artist:b.get("meta").artist||"",duration:b.get("fileLength"),menu_order:a.length,record_id:a.recordId,status:"publish",stream_url:b.get("url"),title:b.get("title")})}),c.reset(),b.setState("tracklist")}})},renderSelectToolbar:function(a){var b=this;a.set("select",{style:"primary",priority:80,text:f.select||"Select",requires:{selection:!0},click:function(){var a=b.state().get("model"),c=b.state().get("selection"),d=b.state().get("setting");a.set(d,c.first().get("url")),c.reset(),b.setState("tracklist")}})},selectionStatusToolbar:function(a){a.set("selection",new m.media.view.Selection({controller:this,collection:this.state("library").get("selection"),priority:-40}))},addUploadedAttachmentAsTrack:function(a,b,c){var d=this.state("tracklist").get("collection");if("tracklist"===this.state().id){try{c=JSON.parse(c.response)}catch(c){return a.error(pluploadL10n.default_error,c,b)}d.add({artist:c.data.meta.artist||"",duration:c.data.fileLength,menu_order:d.length,record_id:d.recordId,status:"publish",stream_url:c.data.url,title:c.data.title})}}}),b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../controllers/record-finder":4,"../../controllers/tracklist":5,"../record-finder":12,"../toolbar/record-finder":14,"../toolbar/tracklist":15,"../tracklist-manager":20,bandstand:"bandstand"}],12:[function(a,b,c){(function(c){"use strict";var d,e=a("./finder/search-group"),f=a("./finder/search-results"),g=a("./finder/services-panel"),h="undefined"!=typeof window?window.wp:"undefined"!=typeof c?c.wp:null;d=h.media.View.extend({className:"bandstand-record-finder",initialize:function(a){this.controller=a.controller},render:function(){var a=this.controller.state();return this.views.set([new e({controller:a,collection:a.get("results"),selection:a.get("selection")}),new g({controller:a}),new f({collection:a.get("results"),selection:a.get("selection")})]),this}}),b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./finder/search-group":7,"./finder/search-results":9,"./finder/services-panel":10}],13:[function(a,b,c){(function(c){"use strict";var d,e="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,f=a("bandstand").l10n,g="undefined"!=typeof window?window.wp:"undefined"!=typeof c?c.wp:null;d=g.media.View.extend({className:"bandstand-tracklist-autonumber-setting",tagName:"span",events:{"change input":"updateAutoNumbering"},initialize:function(a){this.controller=a.controller},render:function(){var a=e.template('<label><input type="checkbox"> <%= text %></label>');return this.$el.html(a({text:f.autoNumber||"Auto-number"})),this.$checkbox=this.$('input[type="checkbox"]'),this.$checkbox.prop("checked",this.controller.state().get("autoNumber")),this},updateAutoNumbering:function(){this.controller.state().set("autoNumber",this.$checkbox.prop("checked"))}}),b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{bandstand:"bandstand"}],14:[function(a,b,c){(function(c){"use strict";var d,e="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,f=a("bandstand").l10n,g="undefined"!=typeof window?window.wp:"undefined"!=typeof c?c.wp:null;d=g.media.view.Toolbar.extend({initialize:function(a){this.controller=a.controller,e.bindAll(this,"importRecord"),this.options.items=e.defaults(this.options.items||{},{import:{text:f.importRecord||"Import Record",style:"primary",priority:80,requires:{selection:!0},click:this.importRecord},spinner:new g.media.view.Spinner({priority:100})}),this.options.items.spinner.delay=0,g.media.view.Toolbar.prototype.initialize.apply(this,arguments)},importRecord:function(){var a=this.get("spinner").show();this.controller.state().importRecord().done(function(){a.hide()})}}),b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{bandstand:"bandstand"}],15:[function(a,b,c){(function(c){"use strict";var d,e="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,f=a("../setting/autonumber"),g=a("bandstand").l10n,h="undefined"!=typeof window?window.wp:"undefined"!=typeof c?c.wp:null;d=h.media.view.Toolbar.extend({initialize:function(a){var b=a.controller.state();this.controller=a.controller,e.bindAll(this,"addTrack","saveTracklist"),this.options.items=e.defaults(this.options.items||{},{add:{text:this.controller.state().get("button").text,style:"secondary",priority:-80,click:this.addTrack},autonumber:new f({controller:this.controller,priority:-60}),save:{text:g.saveTracklist||"Save Tracklist",style:"primary",priority:80,click:this.saveTracklist},spinner:new h.media.view.Spinner({priority:100})}),this.options.items.spinner.delay=0,this.listenTo(b,"change:isDirty",this.toggleButtonState),this.listenTo(b.get("collection"),"add remove reset",this.toggleButtonState),h.media.view.Toolbar.prototype.initialize.apply(this,arguments)},render:function(){return this.$button=this.get("save").$el,this.toggleButtonState(),this},addTrack:function(){var a=this.controller.state(),b=a.get("collection");b.add({menu_order:b.length,record_id:b.recordId,status:"publish"}),a.get("selection").reset(b.last())},saveTracklist:function(){var a=this.controller,b=a.state(),c=this.get("spinner").show();e.invoke(b.get("deleted").toArray(),"destroy"),b.get("collection").save().done(function(){c.hide(),a.close()})},toggleButtonState:function(){var a=this.controller.state(),b=a.get("isDirty"),c=a.get("collection");this.$button.attr("disabled",!b||c.length<1)}}),b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../setting/autonumber":13,bandstand:"bandstand"}],16:[function(a,b,c){(function(c){"use strict";var d,e="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,f=a("../../../modules/template-helpers"),g="undefined"!=typeof window?window.wp:"undefined"!=typeof c?c.wp:null;d=g.media.View.extend({tagName:"div",className:"bandstand-track-edit-form",template:g.template("bandstand-track-edit-form"),initialize:function(a){this.model=a.model,this.listenTo(this.model,"change:track_number",this.updateTrackNumber)},render:function(){var a=e.extend(this.model.toJSON(),f);return this.$el.html(this.template(a)),this},updateTrackNumber:function(){this.$('input[data-setting="track_number"]').val(this.model.get("track_number"))}}),b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../../modules/template-helpers":25}],17:[function(a,b,c){(function(a){"use strict";var c,d="undefined"!=typeof window?window.wp:"undefined"!=typeof a?a.wp:null;c=d.media.View.extend({tagName:"div",className:"bandstand-track-meta",template:d.template("bandstand-track-meta"),events:{"click .js-delete-track":"removeTrack"},initialize:function(a){this.controller=a.controller,this.model=a.model},render:function(){return this.$el.empty(),this.model&&this.$el.html(this.template(this.model.toJSON())),this},removeTrack:function(){var a=this.controller.state();a.get("collection").remove(this.model),a.get("deleted").add(this.model),a.get("selection").remove(this.model)}}),b.exports=c}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],18:[function(a,b,c){(function(c){"use strict";var d,e="undefined"!=typeof window?window.jQuery:"undefined"!=typeof c?c.jQuery:null,f=a("./edit-form"),g=a("./sidebar"),h="undefined"!=typeof window?window.wp:"undefined"!=typeof c?c.wp:null;d=h.media.View.extend({tagName:"div",className:"bandstand-track-panel",events:{"change [data-setting]":"updateAttribute","click .js-select-attachment":"selectMedia",'keyup [data-setting="title"]':"updateAttribute",'keyup [data-setting="track_number"]':"updateAttribute"},initialize:function(a){this.controller=a.controller,this.selection=a.selection,this.listenTo(this.selection,"remove reset",this.render)},render:function(){return this.$el.empty(),this.model=this.selection.first(),this.selection.length?this.views.set([new f({model:this.model}),new g({controller:this.controller,selection:this.selection})]):this.views.set([]),this},selectMedia:function(a){a.preventDefault(),this.controller.setState("select"),this.controller.state().set({model:this.model,setting:e(a.target).closest(".bandstand-input-group").find("[data-setting]").data("setting")})},updateAttribute:function(a){var b=e(a.target),c=b.data("setting"),d=a.target.value;b.is('input[type="checkbox"]')&&(d=b[0].checked),this.model.set(c,d)}}),b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./edit-form":16,"./sidebar":19}],19:[function(a,b,c){(function(c){"use strict";var d,e=a("./meta"),f="undefined"!=typeof window?window.wp:"undefined"!=typeof c?c.wp:null;d=f.media.View.extend({tagName:"div",className:"bandstand-track-sidebar",initialize:function(a){this.controller=a.controller,this.selection=a.selection,this.listenTo(this.selection,"reset",this.render)},render:function(){return this.views.set([new e({controller:this.controller,model:this.selection.first()})]),this}}),b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./meta":17}],20:[function(a,b,c){(function(c){"use strict";var d,e=a("./track/panel"),f=a("./tracks/list"),g="undefined"!=typeof window?window.wp:"undefined"!=typeof c?c.wp:null;d=g.media.View.extend({className:"bandstand-tracklist-manager",initialize:function(a){this.controller=a.controller,this.collection=a.collection,this.selection=a.selection,this.collection.length||(this.collection.add({record_id:this.collection.recordId,status:"publish"}),this.controller.state().set("isDirty",!1)),this.selection.reset(this.collection.first())},render:function(){return this.views.add([new f({collection:this.collection,selection:this.selection}),new e({controller:this.controller,selection:this.selection})]),this}}),b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./track/panel":18,"./tracks/list":24}],21:[function(a,b,c){(function(a){"use strict";var c,d="undefined"!=typeof window?window.wp:"undefined"!=typeof a?a.wp:null;c=d.media.View.extend({tagName:"span",className:"bandstand-tracks-list-item-number",initialize:function(a){this.model=a.model},render:function(){var a=this.model.get("track_number");return a&&(a+=". "),this.$el.text(a),this}}),b.exports=c}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],22:[function(a,b,c){(function(c){"use strict";var d,e="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,f=a("bandstand").l10n,g="undefined"!=typeof window?window.wp:"undefined"!=typeof c?c.wp:null;d=g.media.View.extend({tagName:"span",className:"bandstand-tracks-list-item-title",initialize:function(a){this.model=a.model},render:function(){var a=this.model.get("title"),b=a;return e.isEmpty(b)&&(b=f.addTrackTitle||"Add a title..."),this.$el.text(b).toggleClass("is-empty",e.isEmpty(a)),this}}),b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{bandstand:"bandstand"}],23:[function(a,b,c){(function(c){"use strict";var d,e=a("./list-item-number"),f=a("./list-item-title"),g="undefined"!=typeof window?window.wp:"undefined"!=typeof c?c.wp:null;d=g.media.View.extend({tagName:"li",className:"bandstand-tracks-list-item",events:{click:"setSelection"},initialize:function(a){this.model=a.model,this.selection=a.selection,this.selection.on("reset",this.updateSelected,this),this.listenTo(this.model,"destroy",this.remove),this.listenTo(this.model,"change:title change:track_number",this.render)},render:function(){return this.views.set([new e({model:this.model}),new f({model:this.model})]),this.updateSelected(),this},remove:function(){this.$el.remove()},setSelection:function(){this.selection.reset(this.model)},updateSelected:function(){var a=this.selection.first()===this.model;this.$el.toggleClass("is-selected",a)}}),b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./list-item-number":21,"./list-item-title":22}],24:[function(a,b,c){(function(c){"use strict";var d,e="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,f=a("./list-item"),g="undefined"!=typeof window?window.wp:"undefined"!=typeof c?c.wp:null;d=g.media.View.extend({tagName:"div",className:"bandstand-tracks",initialize:function(a){this._viewsByCid={},this.collection=a.collection,this.selection=a.selection,this.listenTo(this.collection,"add",this.addTrack),this.listenTo(this.collection,"remove",this.removeTrack),this.listenTo(this.collection,"reset",this.render)},render:function(){return this.$list=this.$el.html("<ul />").find("ul"),this.collection.length&&this.collection.each(this.addTrack,this),this.initializeSortable(),this},addTrack:function(a){this.views.add("ul",this.createTrackView(a),{at:this.collection.indexOf(a)})},createTrackView:function(a){var b=new f({model:a,selection:this.selection});return this._viewsByCid[a.cid]=b},initializeSortable:function(){var a=this.collection;this.$list.sortable({axis:"y",delay:150,forceHelperSize:!0,forcePlaceholderSize:!0,opacity:.6,start:function(a,b){b.placeholder.css("visibility","visible"),b.item.data("sortableIndexStart",b.item.index())},update:e.bind(function(b,c){var d=a.at(c.item.data("sortableIndexStart")),e=a.comparator;delete a.comparator,a.remove(d,{silent:!0}),a.add(d,{silent:!0,at:c.item.index()}),a.comparator=e,a.each(function(a,b){a.set("menu_order",b+1)}),a.trigger("reset",a)},this)})},removeTrack:function(a){var b=this._viewsByCid[a.cid];delete this._viewsByCid[a.cid],b&&b.remove()}}),b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./list-item":23}],25:[function(a,b,c){"use strict";b.exports={displayRawTitle:function(){var a=this.title||"";return a.raw||a}}},{}],26:[function(a,b,c){(function(b){"use strict";var c,d,e,f,g,h,i,j="undefined"!=typeof window?window.jQuery:"undefined"!=typeof b?b.jQuery:null,k=a("bandstand"),l="undefined"!=typeof window?window.Backbone:"undefined"!=typeof b?b.Backbone:null,m=a("./discography/collections/record-tracks"),n=a("./discography/views/frame/tracklist"),o="undefined"!=typeof window?window.wp:"undefined"!=typeof b?b.wp:null;f=k.settings(_bandstandTracklistSettings),c=new m(f.tracks,{recordId:f.record.id}),e=new l.Collection([{id:"musicbrainz",name:"MusicBrainz",adapter:a("./discography/adapters/musicbrainz")}]),d=new n({autoNumberTracklist:f.autoNumberTracklist,collection:c,record:f.record,services:e}),d.on("open",function(){var a=d.state("tracklist"),b=a.get("collection"),c=a.get("selection");!c.length&&b.length&&c.reset(b.first())}),d.on("close",function(){c.fetch({data:{context:"edit",record:f.record.id}}).done(function(a){c.reset(a),d.state("tracklist").get("selection").reset()})}),h=o.media.View.extend({tagName:"div",className:"bandstand-tracklist",initialize:function(a){this.collection=a.collection,this.listenTo(this.collection,"add",this.addTrack),this.listenTo(this.collection,"reset",this.render)},render:function(){return this.$list=this.$el.html("<ul />").find("ul"),this.collection.length&&this.collection.each(this.addTrack,this),this},addTrack:function(a){var b=new i({controller:this.controller,model:a});this.views.add("ul",b,{at:this.collection.indexOf(a)})}}),i=o.media.View.extend({tagName:"li",className:"bandstand-tracklist-item",events:{dblclick:"editTrack"},initialize:function(a){this.controller=a.controller,this.model=a.model,this.listenTo(this.model,"destroy",this.remove),this.listenTo(this.model,"change:title change:track_number",this.render)},render:function(){var a="",b=this.model.get("track_number");return b&&(a=b+". "),a+=this.model.get("title"),this.$el.html(a),this},editTrack:function(a){a.preventDefault(),d.state("tracklist").get("selection").reset(this.model),d.open()},remove:function(){this.$el.remove()}}),g=new h({el:document.getElementById("bandstand-tracklist"),collection:c}),g.render(),j(".js-open-tracklist-manager").on("click",function(a){a.preventDefault(),d.open()}),j(document).ready(function(){j("#record-links").bandstandRepeater()})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./discography/adapters/musicbrainz":1,"./discography/collections/record-tracks":2,"./discography/views/frame/tracklist":11,bandstand:"bandstand"}],27:[function(a,b,c){(function(c){"use strict";var d,e=("undefined"!=typeof window?window.wp:"undefined"!=typeof c?c.wp:null).api.WPApiBaseModel,f=a("cuebone/src/models/track"),g=a("bandstand").settings();d=e.extend({methods:["GET","POST","PUT","PATCH","DELETE"],urlRoot:function(){return g.restUrl+"bandstand/v1/tracks"},set:function(a,b,c){"track_number"===a?b=String(b):"object"==typeof a&&"track_number"in a&&(a.track_number=String(a.track_number)),e.prototype.set.call(this,a,b,c)},defaults:{id:null,artist:"",artwork_url:"",download_url:"",duration:"",menu_order:0,purchase_url:"",record_id:0,status:"draft",stream_url:"",title:"",track_number:""}}).extend(f.prototype),b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{bandstand:"bandstand","cuebone/src/models/track":30}],28:[function(a,b,c){"use strict";b.exports={formatTime:function(a){var b,c,d,e="";
return d=parseInt(a,10)%60,c=Math.floor(a/60)%60,b=Math.floor(a/3600),d=d<10?"0"+d:d,b&&(c=c<10?"0"+c:c,e+=b+":"),e+=c+":"+d}}},{}],29:[function(a,b,c){(function(a){"use strict";var c,d="undefined"!=typeof window?window.jQuery:"undefined"!=typeof a?a.jQuery:null,e="undefined"!=typeof window?window._:"undefined"!=typeof a?a._:null,f="undefined"!=typeof window?window.Backbone:"undefined"!=typeof a?a.Backbone:null;c=f.Model.extend({defaults:{current_time:0,duration:0,loaded:0,source:"",status:"",track:null,type:""},initialize:function(a,b){this.canPlay=d.Deferred(),this.mediaElement=null,this.ready=d.when(this.canPlay),e.bindAll(this,"onEnded","onError","onLoadedMetadata","onPause","onPlaying","onReady","onTimeUpdate","updateLoaded")},getProgress:function(){var a=this.get("current_time"),b=this.get("duration");return a/b},load:function(){return this.set("status","loading"),this.mediaElement?(this.mediaElement.setAttribute("preload","auto"),this.mediaElement.setAttribute("src",this.get("source")),this.mediaElement.setAttribute("type",this.get("type")),this.mediaElement.addEventListener("canplay",this.onReady),this.mediaElement.addEventListener("loadedmetadata",this.onReady),this.mediaElement.addEventListener("ended",this.onEnded),this.mediaElement.addEventListener("loadedmetadata",this.onLoadedMetadata),this.mediaElement.addEventListener("error",this.onError),this.mediaElement.addEventListener("pause",this.onPause),this.mediaElement.addEventListener("playing",this.onPlaying),this.mediaElement.addEventListener("loadedmetadata",this.onTimeUpdate),this.mediaElement.addEventListener("timeupdate",this.onTimeUpdate),this.mediaElement.addEventListener("progress",this.updateLoaded),this.mediaElement.addEventListener("timeupdate",this.updateLoaded),void this.mediaElement.load()):void this.set("status","error")},unload:function(){this.set("status","paused"),this.mediaElement.removeEventListener("canplay",this.onReady),this.mediaElement.removeEventListener("loadedmetadata",this.onReady),this.mediaElement.removeEventListener("ended",this.onEnded),this.mediaElement.removeEventListener("loadedmetadata",this.onLoadedMetadata),this.mediaElement.removeEventListener("error",this.onError),this.mediaElement.removeEventListener("pause",this.onPause),this.mediaElement.removeEventListener("playing",this.onPlaying),this.mediaElement.removeEventListener("loadedmetadata",this.onTimeUpdate),this.mediaElement.removeEventListener("timeupdate",this.onTimeUpdate),this.mediaElement.removeEventListener("progress",this.updateLoaded),this.mediaElement.removeEventListener("timeupdate",this.updateLoaded)},mute:function(){this.mediaElement.muted=!0},pause:function(){this.mediaElement&&this.mediaElement.pause(),this.set("status","paused")},play:function(){var a=this;this.ready.done(function(){a.mediaElement.play(),a.set("status","playing")})},seekTo:function(a){var b,c,f=d.Deferred(),g=this.mediaElement;e.isUndefined(a)||(this.ready=d.when(this.canPlay,f),c=function(){return 4===g.readyState&&(g.currentTime=a,clearInterval(b),f.resolve(),!0)},c()||(b=setInterval(c,50)))},setVolume:function(a){this.mediaElement.volume=a},unmute:function(){this.mediaElement.muted=!1},onError:function(){this.set("status","error")},onEnded:function(){this.trigger("ended")},onLoadedMetadata:function(){this.set("duration",this.mediaElement.duration)},onPause:function(){this.set("status","paused")},onPlaying:function(){this.set("status","playing")},onReady:function(){this.canPlay.resolve(),this.set("status","ready")},onTimeUpdate:function(){this.mediaElement&&this.set("current_time",this.mediaElement.currentTime)},updateLoaded:function(){var a;try{a=this.mediaElement.buffered.end(this.mediaElement.buffered.length-1),this.set("loaded",a/this.mediaElement.duration*100)}catch(a){}}}),b.exports=c}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],30:[function(a,b,c){(function(c){"use strict";var d,e=("undefined"!=typeof window?window.jQuery:"undefined"!=typeof c?c.jQuery:null,"undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,"undefined"!=typeof window?window.Backbone:"undefined"!=typeof c?c.Backbone:null),f=a("./media");d=e.Model.extend({defaults:{artist:"",artwork_url:"",download_url:"",duration:"",purchase_url:"",record_id:null,stream_url:"",title:"",track_number:""},initialize:function(a,b){this.media=new f({source:this.get("stream_url"),track:this})}}),b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./media":29}],bandstand:[function(a,b,c){(function(c){"use strict";function d(){var a={};e.extend(this,{collection:{},controller:{},l10n:{},model:{},util:f,view:{}}),this.settings=function(b){return b&&e.extend(a,b),a.l10n&&(this.l10n=e.extend(this.l10n,a.l10n),delete a.l10n),a||{}}}var e="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,f=a("./utils");c.bandstand=c.bandstand||new d,b.exports=c.bandstand}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./utils":28}]},{},[26]);